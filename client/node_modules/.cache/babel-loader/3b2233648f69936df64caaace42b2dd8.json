{"ast":null,"code":"\"use strict\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PeerServer = exports.ExpressPeerServer = void 0;\n\nconst express_1 = __importDefault(require(\"express\"));\n\nconst http_1 = __importDefault(require(\"http\"));\n\nconst https_1 = __importDefault(require(\"https\"));\n\nconst config_1 = __importDefault(require(\"./config\"));\n\nconst instance_1 = require(\"./instance\");\n\nfunction ExpressPeerServer(server, options) {\n  const app = express_1.default();\n  const newOptions = Object.assign(Object.assign({}, config_1.default), options);\n\n  if (newOptions.proxied) {\n    app.set(\"trust proxy\", newOptions.proxied === \"false\" ? false : !!newOptions.proxied);\n  }\n\n  app.on(\"mount\", () => {\n    if (!server) {\n      throw new Error(\"Server is not passed to constructor - \" + \"can't start PeerServer\");\n    }\n\n    instance_1.createInstance({\n      app,\n      server,\n      options: newOptions\n    });\n  });\n  return app;\n}\n\nexports.ExpressPeerServer = ExpressPeerServer;\n\nfunction PeerServer(options = {}, callback) {\n  const app = express_1.default();\n  let newOptions = Object.assign(Object.assign({}, config_1.default), options);\n  const port = newOptions.port;\n  const host = newOptions.host;\n  let server;\n\n  const {\n    ssl\n  } = newOptions,\n        restOptions = __rest(newOptions, [\"ssl\"]);\n\n  if (ssl && Object.keys(ssl).length) {\n    server = https_1.default.createServer(ssl, app);\n    newOptions = restOptions;\n  } else {\n    server = http_1.default.createServer(app);\n  }\n\n  const peerjs = ExpressPeerServer(server, newOptions);\n  app.use(peerjs);\n  server.listen(port, host, () => callback === null || callback === void 0 ? void 0 : callback(server));\n  return peerjs;\n}\n\nexports.PeerServer = PeerServer;","map":{"version":3,"sources":["/usr/local/lib/node_modules/peer/dist/src/index.js"],"names":["__rest","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","__importDefault","mod","__esModule","defineProperty","exports","value","PeerServer","ExpressPeerServer","express_1","require","http_1","https_1","config_1","instance_1","server","options","app","default","newOptions","assign","proxied","set","on","Error","createInstance","callback","port","host","ssl","restOptions","keys","createServer","peerjs","use","listen"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PeerServer = exports.ExpressPeerServer = void 0;\nconst express_1 = __importDefault(require(\"express\"));\nconst http_1 = __importDefault(require(\"http\"));\nconst https_1 = __importDefault(require(\"https\"));\nconst config_1 = __importDefault(require(\"./config\"));\nconst instance_1 = require(\"./instance\");\nfunction ExpressPeerServer(server, options) {\n    const app = express_1.default();\n    const newOptions = Object.assign(Object.assign({}, config_1.default), options);\n    if (newOptions.proxied) {\n        app.set(\"trust proxy\", newOptions.proxied === \"false\" ? false : !!newOptions.proxied);\n    }\n    app.on(\"mount\", () => {\n        if (!server) {\n            throw new Error(\"Server is not passed to constructor - \" +\n                \"can't start PeerServer\");\n        }\n        instance_1.createInstance({ app, server, options: newOptions });\n    });\n    return app;\n}\nexports.ExpressPeerServer = ExpressPeerServer;\nfunction PeerServer(options = {}, callback) {\n    const app = express_1.default();\n    let newOptions = Object.assign(Object.assign({}, config_1.default), options);\n    const port = newOptions.port;\n    const host = newOptions.host;\n    let server;\n    const { ssl } = newOptions, restOptions = __rest(newOptions, [\"ssl\"]);\n    if (ssl && Object.keys(ssl).length) {\n        server = https_1.default.createServer(ssl, app);\n        newOptions = restOptions;\n    }\n    else {\n        server = http_1.default.createServer(app);\n    }\n    const peerjs = ExpressPeerServer(server, newOptions);\n    app.use(peerjs);\n    server.listen(port, host, () => callback === null || callback === void 0 ? void 0 : callback(server));\n    return peerjs;\n}\nexports.PeerServer = PeerServer;\n"]},"metadata":{},"sourceType":"script"}