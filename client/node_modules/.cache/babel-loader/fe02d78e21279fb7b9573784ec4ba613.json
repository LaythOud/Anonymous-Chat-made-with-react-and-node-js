{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst express_1 = __importDefault(require(\"express\"));\n\nexports.default = ({\n  realm,\n  messageHandler\n}) => {\n  const app = express_1.default.Router();\n\n  const handle = (req, res, next) => {\n    const {\n      id\n    } = req.params;\n    if (!id) return next();\n    const client = realm.getClientById(id);\n\n    if (!client) {\n      throw new Error(`client not found:${id}`);\n    }\n\n    const {\n      type,\n      dst,\n      payload\n    } = req.body;\n    const message = {\n      type,\n      src: id,\n      dst,\n      payload\n    };\n    messageHandler.handle(client, message);\n    res.sendStatus(200);\n  };\n\n  app.post(\"/offer\", handle);\n  app.post(\"/candidate\", handle);\n  app.post(\"/answer\", handle);\n  app.post(\"/leave\", handle);\n  return app;\n};","map":{"version":3,"sources":["/usr/local/lib/node_modules/peer/dist/src/api/v1/calls/index.js"],"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","express_1","require","default","realm","messageHandler","app","Router","handle","req","res","next","id","params","client","getClientById","Error","type","dst","payload","body","message","src","sendStatus","post"],"mappings":"AAAA;;AACA,IAAIA,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;AACnE,SAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;AAAE,eAAWA;AAAb,GAAvC;AACH,CAFD;;AAGAE,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,MAAMC,SAAS,GAAGP,eAAe,CAACQ,OAAO,CAAC,SAAD,CAAR,CAAjC;;AACAH,OAAO,CAACI,OAAR,GAAkB,CAAC;AAAEC,EAAAA,KAAF;AAASC,EAAAA;AAAT,CAAD,KAA+B;AAC7C,QAAMC,GAAG,GAAGL,SAAS,CAACE,OAAV,CAAkBI,MAAlB,EAAZ;;AACA,QAAMC,MAAM,GAAG,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,KAAoB;AAC/B,UAAM;AAAEC,MAAAA;AAAF,QAASH,GAAG,CAACI,MAAnB;AACA,QAAI,CAACD,EAAL,EACI,OAAOD,IAAI,EAAX;AACJ,UAAMG,MAAM,GAAGV,KAAK,CAACW,aAAN,CAAoBH,EAApB,CAAf;;AACA,QAAI,CAACE,MAAL,EAAa;AACT,YAAM,IAAIE,KAAJ,CAAW,oBAAmBJ,EAAG,EAAjC,CAAN;AACH;;AACD,UAAM;AAAEK,MAAAA,IAAF;AAAQC,MAAAA,GAAR;AAAaC,MAAAA;AAAb,QAAyBV,GAAG,CAACW,IAAnC;AACA,UAAMC,OAAO,GAAG;AACZJ,MAAAA,IADY;AAEZK,MAAAA,GAAG,EAAEV,EAFO;AAGZM,MAAAA,GAHY;AAIZC,MAAAA;AAJY,KAAhB;AAMAd,IAAAA,cAAc,CAACG,MAAf,CAAsBM,MAAtB,EAA8BO,OAA9B;AACAX,IAAAA,GAAG,CAACa,UAAJ,CAAe,GAAf;AACH,GAjBD;;AAkBAjB,EAAAA,GAAG,CAACkB,IAAJ,CAAS,QAAT,EAAmBhB,MAAnB;AACAF,EAAAA,GAAG,CAACkB,IAAJ,CAAS,YAAT,EAAuBhB,MAAvB;AACAF,EAAAA,GAAG,CAACkB,IAAJ,CAAS,SAAT,EAAoBhB,MAApB;AACAF,EAAAA,GAAG,CAACkB,IAAJ,CAAS,QAAT,EAAmBhB,MAAnB;AACA,SAAOF,GAAP;AACH,CAzBD","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst express_1 = __importDefault(require(\"express\"));\nexports.default = ({ realm, messageHandler }) => {\n    const app = express_1.default.Router();\n    const handle = (req, res, next) => {\n        const { id } = req.params;\n        if (!id)\n            return next();\n        const client = realm.getClientById(id);\n        if (!client) {\n            throw new Error(`client not found:${id}`);\n        }\n        const { type, dst, payload } = req.body;\n        const message = {\n            type,\n            src: id,\n            dst,\n            payload\n        };\n        messageHandler.handle(client, message);\n        res.sendStatus(200);\n    };\n    app.post(\"/offer\", handle);\n    app.post(\"/candidate\", handle);\n    app.post(\"/answer\", handle);\n    app.post(\"/leave\", handle);\n    return app;\n};\n"]},"metadata":{},"sourceType":"script"}