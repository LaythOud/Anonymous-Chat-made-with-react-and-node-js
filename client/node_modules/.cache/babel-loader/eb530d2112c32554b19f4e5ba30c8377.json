{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useState } from 'react';\nimport Peer from 'peerjs';\nexport default function PeerJs(props) {\n  _s();\n\n  const [streamClient, setStreamClient] = useState();\n  const [peer, setPeer] = useState();\n  const myPeer = new Peer(undefined, {\n    host: '/',\n    port: '3001'\n  });\n  const myVideo = document.createElement('video');\n  myVideo.muted = true;\n  let videoGrid = document.getElementById('video-grid');\n  let counter = 0;\n\n  if (navigator.mediaDevices) {\n    if (counter === 0) {\n      navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: true\n      }).then(stream => {\n        console.log(1);\n        addVideoStream(myVideo, stream);\n        counter++;\n        setStreamClient(stream);\n        myPeer.on('call', call => {\n          call.answer(stream);\n          const video = document.createElement('video');\n          call.on('stream', userVideoStream => {\n            console.log(2);\n            addVideoStream(video, userVideoStream);\n          });\n        });\n      });\n    }\n  }\n\n  function connectToNewUser(userId, stream) {\n    const call = myPeer.call(userId, stream);\n    const video = document.createElement('video');\n    call.on('stream', userVideoStream => {\n      console.log(3);\n      addVideoStream(video, userVideoStream);\n    });\n    call.on('close', () => {\n      video.remove();\n    });\n    setPeer(call);\n  }\n\n  function addVideoStream(video, stream) {\n    video.srcObject = stream;\n    video.addEventListener('loadedmetadata', () => {\n      video.play();\n    });\n    videoGrid = document.getElementById('video-grid');\n    videoGrid.append(video);\n  }\n\n  props.socket.addEventListener('message', event => {\n    const messageObj = JSON.parse(event.data);\n\n    switch (messageObj.type) {\n      case 'user-connected':\n        connectToNewUser(messageObj.data, streamClient);\n        break;\n\n      case 'user-disconnected':\n        if (peer) peer.close();\n        break;\n\n      default:\n        break;\n    }\n  });\n  return '';\n}\n\n_s(PeerJs, \"PleBH3HFBlVgdcIEvzh9ox+0TOg=\");\n\n_c = PeerJs;\n\nvar _c;\n\n$RefreshReg$(_c, \"PeerJs\");","map":{"version":3,"sources":["/media/lizard/02d10dea-b08f-45b8-a5ad-a36d5f9f2e04/lizard/WEB/PROJECT/Anonymous-Chat/client/src/Component/PeerJs.js"],"names":["useState","Peer","PeerJs","props","streamClient","setStreamClient","peer","setPeer","myPeer","undefined","host","port","myVideo","document","createElement","muted","videoGrid","getElementById","counter","navigator","mediaDevices","getUserMedia","video","audio","then","stream","console","log","addVideoStream","on","call","answer","userVideoStream","connectToNewUser","userId","remove","srcObject","addEventListener","play","append","socket","event","messageObj","JSON","parse","data","type","close"],"mappings":"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","sourcesContent":["import  { useState } from 'react';\nimport Peer from 'peerjs'\n\nexport default function PeerJs(props) {\n\n\n const [streamClient , setStreamClient] = useState()\n const [peer , setPeer] = useState()\n\n const myPeer = new Peer(undefined ,{\n    host:'/',\n    port:'3001'\n})\n\n\nconst myVideo = document.createElement('video')\nmyVideo.muted = true\nlet videoGrid = document.getElementById('video-grid')\nlet counter = 0\n\nif(navigator.mediaDevices){\n\tif(counter === 0){\n\t\tnavigator.mediaDevices.getUserMedia({\n\t\t\tvideo:true,\n\t\t\taudio:true\n\t\t}).then(stream =>{\n\t\t\tconsole.log(1)\n\t\t\taddVideoStream(myVideo , stream)\n\t\t\tcounter++\n\t\t\tsetStreamClient(stream)\n\n\t\t\tmyPeer.on('call' , call =>{\n\t\t\t\tcall.answer(stream)\n\t\t\t\tconst video = document.createElement('video')\n\t\t\t\tcall.on('stream' , userVideoStream =>{\n\t\t\t\t\tconsole.log(2)\n\t\t\t\t\taddVideoStream(video , userVideoStream)\n\t\t\t\t})\n\t\t\t})\n\t\t\t\n\t\t})\n\t}\n}\n\nfunction connectToNewUser(userId ,stream) {\n\tconst call = myPeer.call(userId ,stream)\n\tconst video = document.createElement('video')\n\tcall.on('stream' , userVideoStream =>{\n\t\tconsole.log(3)\n\t\taddVideoStream(video , userVideoStream)\n\t})\n\tcall.on('close' ,()=>{\n\t\tvideo.remove()\n    })\n    setPeer(call)\n}\n\n function addVideoStream(video , stream) {\n \tvideo.srcObject = stream\n \tvideo.addEventListener('loadedmetadata',() =>{\n \t\tvideo.play();\n \t})\n\tvideoGrid = document.getElementById('video-grid') \n\tvideoGrid.append(video)\n }\n\n\n props.socket.addEventListener('message' , event =>{\n    const messageObj = JSON.parse(event.data)\n    switch (messageObj.type) {\n        case 'user-connected':\n            connectToNewUser(messageObj.data ,streamClient)\n            break\n        case 'user-disconnected':\n            if(peer) peer.close()\n            break\n        default:\n            break\n    }\n})\n\nreturn ('')\n}"]},"metadata":{},"sourceType":"module"}